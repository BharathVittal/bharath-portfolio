<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bharath Vittal</title>

    <!-- Tailwind CDN + config (ONLY ONCE) -->
    <script>
      tailwind = { config: { darkMode: "class" } };
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
    <!-- ElevenLabs Voice Assistant -->
    <elevenlabs-convai agent-id="agent_8201kd4594xdfc9tmzh4qptfv2df"></elevenlabs-convai>
    <script
      src="https://unpkg.com/@elevenlabs/convai-widget-embed"
      async
      type="text/javascript">
    </script>
    <!-- Cal floating-popup embed -->
    <script type="text/javascript">
      (function (C, A, L) {
        let p = function (a, ar) { a.q.push(ar); };
        let d = C.document;
        C.Cal = C.Cal || function () {
          let cal = C.Cal;
          let ar = arguments;
          if (!cal.loaded) {
            cal.ns = {};
            cal.q = cal.q || [];
            d.head.appendChild(d.createElement("script")).src = A;
            cal.loaded = true;
          }
          if (ar[0] === L) {
            const api = function () { p(api, arguments); };
            const namespace = ar[1];
            api.q = api.q || [];
            if (typeof namespace === "string") {
              cal.ns[namespace] = cal.ns[namespace] || api;
              p(cal.ns[namespace], ar);
              p(cal, ["initNamespace", namespace]);
            } else p(cal, ar);
            return;
          }
          p(cal, ar);
        };
      })(window, "https://app.cal.com/embed/embed.js", "init");

      Cal("init", "15min", { origin: "https://app.cal.com" });

      Cal.ns["15min"]("floatingButton", {
        calLink: "bharathvittal/15min",
        config: {
          layout: "month_view",
          position: "bottom-left"
        }
      });

      Cal.ns["15min"]("ui", {
        hideEventTypeDetails: false,
        layout: "month_view"
      });
    </script>
    <!-- Auto-open ElevenLabs widget after a short delay (once per session, desktop only) -->
    <script>
      (function () {
        // Do not auto-open on mobile or if already opened in this session
        if (
          sessionStorage.getItem("dwight_widget_opened") ||
          window.innerWidth < 768
        ) return;

        const OPEN_DELAY_MS = 4000; // 4-second nudge

        function tryOpenWidget() {
          const widget = document.querySelector("elevenlabs-convai");
          if (!widget || !widget.shadowRoot) return;

          const openButton =
            widget.shadowRoot.querySelector("button") ||
            widget.shadowRoot.querySelector('[role="button"]');

          if (openButton) {
            openButton.click();
            sessionStorage.setItem("dwight_widget_opened", "true");
          }
        }

        setTimeout(() => {
          const interval = setInterval(() => {
            tryOpenWidget();
            if (sessionStorage.getItem("dwight_widget_opened")) {
              clearInterval(interval);
            }
          }, 500);
        }, OPEN_DELAY_MS);
      })();
    </script>
  </body>
</html>